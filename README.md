# mpqplattice

This C-toolbox mpqplattice is a C++ implementation which solves the explicit Model Predictive Control (eMPC) problem, which is essentially a multi-parametric quadratic programs (mp-QP) formulated as
$$(1a)\quad \mathbf u^\star_N(x_0) = \arg \min_{\mathbf u_N} \frac{1}{2} \mathbf u_N^\top \tilde Q \mathbf u_N + x_0^\top \tilde H \mathbf u_N $$
$$(1b)\quad \text{s.t. } A \mathbf u_N \leq F x_0+b. $$

The solution is a piece-wise affine function of the state vector $x$ and it's stored in a tree that is orginsed like a poset (i.e., partially ordered set) defined by the indices of inequalities in (2) that become active.

Our algorithm exploits the geometrical properties of the problem [1] by constructing the face-lattice of the lifted feasible domain described by the polytope
$ 
\begin{equation}
    P = \Big\{ x: \begin{bmatrix} A& -F\end{bmatrix} x \leq b\Big\} .
\end{equation}
$

## Usage
The toolbox can be used in two ways:
- **Generate the entire face-lattice (or the (N-dx)-skeleton) and search the sollutions among the faces**: this implementation is slow because the dimension of the face-lattice increases quickly with the prediction horizon (N) and the dimension of the state-space vector (dx). However, this implementation may be preferred when you want to change the cost matrices $\tilde Q$ and $\tilde H$, since the face-lattice remains the same. [*]

- **Only compute the face-lattice generated by the faces that contribute to the solution**: this implementation is quite fast and uses a modified version of the face-lattice algorithm in [2]. Presently, the main drawback is that we require cddlib [3] for face enumeration and it can be slow depending on the problem. We are investigating the use of mplrs [4]. [**]

### Remarks
[*] see the branch *release-1*.

[**] see the branch *release-2*.

## References
[1] Ş. S. Mihai, F. Stoican, and B. D. Ciubotaru, “On the link between explicit MPC and the face lattice of the lifted feasible domain,” IFAC-PapersOnLine, vol. 55, no. 16, pp. 308–313, 2022.

[2] V. Kaibel and M. E. Pfetsch, “Computing the face lattice of a polytope from its vertex-facet incidences,” Computational Geometry, vol. 23, no. 3, pp. 281–290, 2002.

[3] Fukuda, K., 2003. Cddlib reference manual. Report version 093a, McGill University, Montréal, Quebec, Canada.

[4] Avis, D. and Jordan, C., 2018. mplrs: A scalable parallel vertex/facet enumeration code. Mathematical Programming Computation, 10(2), pp.267-302.
